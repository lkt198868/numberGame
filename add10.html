<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>æ•°å­—æ±‚å’Œæ¸¸æˆ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .target-display {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e74c3c;
        }

        .current-sum {
            font-size: 1.2rem;
            font-weight: bold;
            color: #3498db;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        /* é“¾æ¥æŒ‰é’®æ ·å¼ï¼ˆç”¨äºé¡µé¢è·³è½¬ï¼‰ */
        .link-btn {
            display: inline-block;
            background-color: #9b59b6;
            color: #fff;
            text-decoration: none;
            padding: 8px 14px;
            border-radius: 5px;
            font-size: 0.95rem;
            transition: background-color 0.3s;
        }

        .link-btn:hover {
            background-color: #7d3c98;
        }

        .nav-controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }

        .check-btn {
            background-color: #27ae60;
        }

        .check-btn:hover {
            background-color: #229954;
        }

        .reset-btn {
            background-color: #e74c3c;
        }

        .reset-btn:hover {
            background-color: #c0392b;
        }

        .numbers-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .number-card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }

        .number-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .number-card.selected {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
            transform: scale(1.05);
        }

        .message {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message.success {
            background-color: #e8f8f5;
            color: #27ae60;
            border: 1px solid #27ae60;
        }

        .message.error {
            background-color: #fdedec;
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }

        .message.info {
            background-color: #e3f2fd;
            color: #3498db;
            border: 1px solid #3498db;
        }

        /* èƒœåˆ©åŠ¨ç”» */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .winner {
            animation: pulse 0.5s ease-in-out 3;
        }

        /* æ’’èŠ±ç‰¹æ•ˆæ ·å¼ */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 9999;
            pointer-events: none;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @media (max-width: 600px) {
            .numbers-container {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .game-info {
                flex-direction: column;
                gap: 10px;
            }
        }
        /* çƒŸèŠ±ç‰¹æ•ˆæ ·å¼ */
        .firework {
            position: absolute;
            pointer-events: none;
        }

        /* ç²’å­æ ·å¼ */
        .firework-particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
        }

        /* çˆ†ç‚¸åŠ¨ç”» */
        @keyframes explode {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0);
            }
            10% {
                opacity: 1;
            }
            70% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translate(var(--end-x), var(--end-y)) scale(var(--final-scale));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ•°å­—æ±‚å’Œæ¸¸æˆ</h1>
            <p class="subtitle">é€‰æ‹©æ•°å­—ï¼Œä½¿å®ƒä»¬çš„å’Œç­‰äºç›®æ ‡æ•°å­—</p>
        </header>

        <div class="nav-controls">
            <a href="index.html" class="link-btn">è¿”å›é¦–é¡µ</a>
        </div>

        <div class="game-info">
            <div class="target-display">ç›®æ ‡æ•°å­—: <span id="targetNumber">0</span></div>
            <div class="current-sum">å½“å‰å’Œ: <span id="currentSum">0</span></div>
        </div>

        <div class="message info" id="message">è¯·é€‰æ‹©æ•°å­—</div>

        <div class="controls">
            <button id="actionButton">ç¡®è®¤</button>
        </div>

        <div class="numbers-container" id="numbersContainer">
            <!-- æ•°å­—å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- æ’’èŠ±ç‰¹æ•ˆå®¹å™¨ -->
    <div class="confetti-container" id="confettiContainer"></div>

    <script src="effects.js"></script>
    <script>
        // æ¸¸æˆçŠ¶æ€
        let targetNumber = 0;
        let previousTargetNumber = -1; // è®°å½•ä¸Šä¸€æ¬¡çš„ç›®æ ‡æ•°å­—ï¼Œåˆå§‹åŒ–ä¸º-1ç¡®ä¿ä¸ç¬¬ä¸€æ¬¡ç”Ÿæˆçš„ç›®æ ‡æ•°å­—ä¸åŒ
        let numbers = [];
        let selectedNumbers = [];
        let gameWon = false;
        
        // å›æº¯ç®—æ³•æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ä¸€ç»„ç‰¹å®šæ•°é‡çš„æ•°å­—ï¼Œå…¶å’Œç­‰äºç›®æ ‡æ•°å­—
        function findSolution(numbers, count, target, result) {
            // æ¸…ç©ºç»“æœæ•°ç»„
            result.length = 0;
            
            // è°ƒç”¨å›æº¯å‡½æ•°
            return backtrack(numbers, 0, 0, count, target, [], result);
        }
        
        // å›æº¯è¾…åŠ©å‡½æ•°
        function backtrack(numbers, startIndex, currentSum, count, target, path, result) {
            // å¦‚æœå½“å‰è·¯å¾„é•¿åº¦ç­‰äºè¦æ±‚çš„æ•°é‡ï¼Œä¸”å’Œç­‰äºç›®æ ‡ï¼Œæ‰¾åˆ°è§£
            if (path.length === count && currentSum === target) {
                // å°†æ‰¾åˆ°çš„è§£å¤åˆ¶åˆ°ç»“æœæ•°ç»„
                result.push(...path.slice());
                return true;
            }
            
            // å¦‚æœè·¯å¾„é•¿åº¦å·²è¾¾åˆ°è¦æ±‚æˆ–å’Œå·²ç»è¶…è¿‡ç›®æ ‡ï¼Œåœæ­¢æ¢ç´¢
            if (path.length >= count || currentSum > target) {
                return false;
            }
            
            // å°è¯•ä»startIndexå¼€å§‹é€‰æ‹©æ•°å­—
            for (let i = startIndex; i < numbers.length; i++) {
                // æ·»åŠ å½“å‰æ•°å­—åˆ°è·¯å¾„
                path.push(i);
                
                // é€’å½’æ¢ç´¢
                if (backtrack(numbers, i + 1, currentSum + numbers[i], count, target, path, result)) {
                    return true; // æ‰¾åˆ°è§£ï¼Œæå‰è¿”å›
                }
                
                // å›æº¯ï¼Œç§»é™¤å½“å‰æ•°å­—
                path.pop();
            }
            
            return false; // æœªæ‰¾åˆ°è§£
        }

        // ä»¥ä¸Šç‰¹æ•ˆæ–¹æ³•å·²ç§»è‡³ effects.jsï¼ˆcreateConfetti / createFireworksï¼‰

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            selectedNumbers = [];
            gameWon = false;
            
            // ç”Ÿæˆç›®æ ‡æ•°å­— (5-10)ï¼Œç¡®ä¿ä¸ä¸Šä¸€æ¬¡ä¸åŒ
            do {
                targetNumber = Math.floor(Math.random() * 6) + 5;
            } while (targetNumber === previousTargetNumber);
            
            // æ›´æ–°ä¸Šä¸€æ¬¡çš„ç›®æ ‡æ•°å­—ä¸ºå½“å‰ç›®æ ‡æ•°å­—
            previousTargetNumber = targetNumber;
            
            // ç”Ÿæˆéšæœºæ•°å­—ç»„ (6-9ä¸ªæ•°å­—ï¼ŒèŒƒå›´2-9ï¼Œä¸”ä¸åŒ…å«ç›®æ ‡æ•°å­—)
            const count = Math.floor(Math.random() * 4) + 6; // 6-9ä¸ªæ•°å­—
            numbers = [];
            
            for (let i = 0; i < count; i++) {
                let num;
                do {
                    num = Math.floor(Math.random() * 8) + 2; // 2-9çš„éšæœºæ•°
                } while (num === targetNumber); // ç¡®ä¿ä¸ç­‰äºç›®æ ‡æ•°å­—
                numbers.push(num);
            }
            
            // ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªè§£ï¼šéšæœºé€‰æ‹©2-4ä¸ªæ•°å­—çš„å’Œä½œä¸ºç›®æ ‡ï¼ˆç°åœ¨ç›®æ ‡å·²ç¡®å®šï¼Œè¦ç¡®ä¿æ•°å­—ä¸­å­˜åœ¨è§£ï¼‰
            const solutionIndices = [];
            
            // æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ç»„æ•°å­—çš„å’Œç­‰äºç›®æ ‡æ•°å­—
            let hasSolution = false;
            let attempts = 0;
            
            // å°è¯•ç”Ÿæˆä¸€ä¸ªè§£ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è§£ï¼Œåˆ™é‡æ–°ç”Ÿæˆæ•°å­—
            while (!hasSolution && attempts < 10) {
                // å°è¯•æ‰¾åˆ°2-4ä¸ªæ•°å­—çš„ç»„åˆï¼Œå’Œç­‰äºç›®æ ‡æ•°å­—
                for (let numCount = 2; numCount <= 4 && !hasSolution; numCount++) {
                    // ä½¿ç”¨å›æº¯æ³•æŸ¥æ‰¾æ˜¯å¦æœ‰è§£
                    hasSolution = findSolution(numbers, numCount, targetNumber, solutionIndices);
                }
                
                // å¦‚æœæ²¡æœ‰è§£ï¼Œé‡æ–°ç”Ÿæˆæ•°å­—
                if (!hasSolution) {
                    numbers = [];
                    for (let i = 0; i < count; i++) {
                        let num;
                        do {
                            num = Math.floor(Math.random() * 8) + 2; // 2-9çš„éšæœºæ•°
                        } while (num === targetNumber); // ç¡®ä¿ä¸ç­‰äºç›®æ ‡æ•°å­—
                        numbers.push(num);
                    }
                }
                
                attempts++;
            }
            
            // å¦‚æœä»ç„¶æ²¡æœ‰æ‰¾åˆ°è§£ï¼Œæ·»åŠ ä¸€äº›æ›´å¯èƒ½å½¢æˆè§£çš„æ•°å­—
            if (!hasSolution) {
                // æ·»åŠ ä¸¤ä¸ªè¾ƒå°çš„æ•°å­—ï¼Œä½¿å®ƒä»¬çš„å’Œç­‰äºç›®æ ‡æ•°å­—
                const num1 = Math.floor(Math.random() * (targetNumber - 3)) + 2; // 2åˆ°(targetNumber-2)çš„éšæœºæ•°
                const num2 = targetNumber - num1;
                
                // ç¡®ä¿ä¸¤ä¸ªæ•°å­—éƒ½ç¬¦åˆè¦æ±‚
                if (num2 >= 2 && num2 <= 9 && num2 !== targetNumber) {
                    // ç§»é™¤ä¸¤ä¸ªç°æœ‰çš„æ•°å­—å¹¶æ·»åŠ è¿™ä¸¤ä¸ªæ–°æ•°å­—
                    numbers.splice(0, 2);
                    numbers.push(num1, num2);
                }
            }
            
            // è®¾ç½®æœ€ç»ˆç›®æ ‡æ•°å­—
            // targetNumberå·²ç»åœ¨ä¸Šé¢è®¡ç®—å¥½äº†ï¼Œä¸éœ€è¦é¢å¤–èµ‹å€¼
            
            // æ˜¾ç¤ºæ¸¸æˆä¿¡æ¯
            document.getElementById('targetNumber').textContent = targetNumber;
            document.getElementById('currentSum').textContent = '0';
            
            // åˆ›å»ºæ•°å­—å¡ç‰‡
            const container = document.getElementById('numbersContainer');
            container.innerHTML = '';
            
            numbers.forEach((number, index) => {
                const card = document.createElement('div');
                card.className = 'number-card';
                card.textContent = number;
                card.dataset.index = index;
                card.dataset.value = number;
                
                // æ·»åŠ ç‚¹å‡»å’Œè§¦æ‘¸äº‹ä»¶å¤„ç†
                const handleCardInteraction = function() {
                    if (gameWon) return;
                    
                    if (this.classList.contains('selected')) {
                        // å–æ¶ˆé€‰æ‹©
                        this.classList.remove('selected');
                        const idx = selectedNumbers.indexOf(index);
                        if (idx > -1) {
                            selectedNumbers.splice(idx, 1);
                        }
                    } else {
                        // é€‰æ‹©æ•°å­—
                        this.classList.add('selected');
                        selectedNumbers.push(index);
                    }
                    
                    updateCurrentSum();
                };
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼ˆæ¡Œé¢ç«¯ï¼‰
                card.addEventListener('click', handleCardInteraction);
                
                // æ·»åŠ è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
                card.addEventListener('touchstart', function(e) {
                    e.preventDefault(); // é˜²æ­¢è§¦æ‘¸äº‹ä»¶è§¦å‘ç‚¹å‡»äº‹ä»¶
                    handleCardInteraction.call(this);
                }, { passive: false });
                
                container.appendChild(card);
            });
            
            // é‡ç½®æ¶ˆæ¯
            updateMessage('è¯·é€‰æ‹©æ•°å­—', 'info');
        }

        // æ›´æ–°å½“å‰å’Œ
        function updateCurrentSum() {
            let sum = 0;
            for (const index of selectedNumbers) {
                sum += numbers[index];
            }
            
            document.getElementById('currentSum').textContent = sum;
            
            // å¦‚æœå½“å‰å’Œç­‰äºç›®æ ‡æ•°å­—ï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            // if (sum === targetNumber && selectedNumbers.length > 0) {
            //     // updateMessage('å¤ªæ£’äº†ï¼ä½ æ‰¾åˆ°äº†æ­£ç¡®çš„ç»„åˆï¼ç‚¹å‡»"æ£€æŸ¥ç­”æ¡ˆ"ç¡®è®¤', 'success');
            // } else 
            if (sum > targetNumber && selectedNumbers.length >= 4) {
                updateMessage('å½“å‰å’Œå·²ç»è¶…è¿‡ç›®æ ‡æ•°å­—ï¼Œè¯·å–æ¶ˆé€‰æ‹©ä¸€äº›æ•°å­—', 'error');
                return
            } 
            updateMessage('è¯·é€‰æ‹©æ•°å­—', 'info');
            return
        }

        // æ›´æ–°æ¶ˆæ¯
        function updateMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
        }

        // å¤„ç†æŒ‰é’®ç‚¹å‡»
        function handleAction() {
            if (gameWon) {
                // å¦‚æœæ¸¸æˆå·²èƒœåˆ©ï¼Œç‚¹å‡»"å†æ¥ä¸€æ¬¡"åˆ™é‡ç½®æ¸¸æˆ
                resetGame();
            } else {
                // å¦åˆ™æ£€æŸ¥ç­”æ¡ˆ
                checkSolution();
            }
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkSolution() {
            let sum = 0;
            for (const index of selectedNumbers) {
                sum += numbers[index];
            }
            
            if (sum === targetNumber && selectedNumbers.length > 0) {
                // æˆåŠŸ
                gameWon = true;
                updateMessage('æ­å–œä½ ï¼ä½ èµ¢äº†ï¼ğŸ‰', 'success');
                
                // æ·»åŠ èƒœåˆ©åŠ¨ç”»
                document.querySelector('.container').classList.add('winner');
                
                // éšæœºé€‰æ‹©ä¸€ä¸ªç‰¹æ•ˆï¼ˆæ’’èŠ±æˆ–çƒŸèŠ±ï¼‰
                if (Math.random() > 0.5) {
                    // è§¦å‘æ’’èŠ±ç‰¹æ•ˆ
                    createConfetti();
                } else {
                    // è§¦å‘çƒŸèŠ±ç‰¹æ•ˆ
                    createFireworks();
                }
                
                // æ›´æ”¹æŒ‰é’®æ–‡æœ¬ä¸º"å†æ¥ä¸€æ¬¡"
                document.getElementById('actionButton').textContent = 'å†æ¥ä¸€æ¬¡';
                
                // ç§»é™¤åŠ¨ç”»ç±»
                setTimeout(() => {
                    document.querySelector('.container').classList.remove('winner');
                }, 1500);
            } else if (selectedNumbers.length === 0) {
                // å¤±è´¥ - æ²¡æœ‰é€‰æ‹©æ•°å­—
                updateMessage('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ•°å­—', 'error');
            } else {
                // å¤±è´¥ - å’Œä¸ç›¸ç­‰
                updateMessage(`å½“å‰å’Œæ˜¯ ${sum}ï¼Œä¸ç­‰äºç›®æ ‡æ•°å­— ${targetNumber}ï¼Œè¯·ç»§ç»­å°è¯•`, 'error');
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            // é‡ç½®æŒ‰é’®æ–‡æœ¬
            document.getElementById('actionButton').textContent = 'ç¡®è®¤';
            
            // åˆå§‹åŒ–æ–°æ¸¸æˆ
            initGame();
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ¸¸æˆ
        window.onload = function() {
            initGame();
            
            // ä¸ºæŒ‰é’®æ·»åŠ ç‚¹å‡»å’Œè§¦æ‘¸äº‹ä»¶ç›‘å¬å™¨
            const actionButton = document.getElementById('actionButton');
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼ˆæ¡Œé¢ç«¯ï¼‰
            actionButton.addEventListener('click', handleAction);
            
            // æ·»åŠ è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
            actionButton.addEventListener('touchstart', function(e) {
                e.preventDefault(); // é˜²æ­¢è§¦æ‘¸äº‹ä»¶è§¦å‘ç‚¹å‡»äº‹ä»¶
                handleAction();
            }, { passive: false });
        };
    </script>
</body>
</html>